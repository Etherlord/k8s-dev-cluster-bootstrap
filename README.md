## Подготовка кластера с помощью ansible

Данный раздел актуален только для инициализации кластера, работающего на базе последнего стабильного выпуска Debian.
Будет создан кластер из одной мастер ноды и одной ноды под рабочие нагрузки.

1. Создайте файл `hosts.yaml` по примеру из `hosts.yaml.dist`. Переменные, касающиеся gitlab, нужны только для установки FluxCD.
Если вы не планируете устанавливать Flux - эти переменные можно не заполнять.
2. Установите для ansible коллекцию `community.general` с помощью команды `ansible-galaxy collection install community.general`
3. Запустите команду
    ```shell script
    make cluster
    ```

4. После завершения работы в `hosts.yaml`:
    * Поменяйте `ansible_port` на тот, что указали в переменной `ssh_port`

5. **Опционально**
Для установки FluxCD необходимо заполнить переменные, относящиеся к gitlab.
* Создаем репозиторий, который будет отслеживать FluxCD
* Создаем Personal Access Token с правами `api, read_repository, write_repository`
* Заполняем переменные в `hosts.yaml`
* Выполняем:
   ```shell script
   make install-flux
   ```
* После успешного завершения команды удаляем Personal Access Token в гитлабе, он был нужен только на этапе установки FluxCD.
